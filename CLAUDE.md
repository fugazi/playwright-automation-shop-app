# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## Commands

### Setup
```bash
pnpm install                                    # Install dependencies
npx playwright install --with-deps chromium     # Install Chromium browser
```

### Running Tests
```bash
pnpm test                    # All tests (headless)
pnpm run test:smoke          # Critical path tests (@smoke tag)
pnpm run test:regression     # Full regression suite (@regression tag)
pnpm run test:headed         # Visible browser mode
pnpm run test:debug          # Debug mode with Playwright Inspector
pnpm run test:report         # Open HTML test report
```

### Development
```bash
npx playwright test --list   # List all tests with titles
npx playwright test --grep "@tag"  # Run tests matching a pattern
npx playwright test auth.setup    # Regenerate auth storage states
```

## Architecture

### Project Overview
Music-Tech Shop is a Playwright + TypeScript automation framework for an e-commerce application at https://music-tech-shop.vercel.app. The framework follows the Page Object Model (POM) pattern with feature-based test organization.

### Test Organization
- **`tests/e2e/`** — Feature-based test suites (auth, products, cart, navigation, etc.)
- **`tests/pages/`** — Page Object Model classes
- **`tests/fixtures/`** — Custom Playwright fixtures (auth, pages, cart)
- **`tests/data/`** — Externalized test data with TypeScript interfaces
- **`tests/helpers/`** — Utility functions (validation, price formatting, pagination)

### Page Object Model Pattern
All page objects extend `BasePage` which composes `HeaderComponent` and `FooterComponent`. Page objects follow a fluent interface pattern (methods return `this` for chaining). Locators are role-based only (`getByRole`, `getByLabel`, `getByText`) for accessibility.

Key page objects: `HomePage`, `ProductsPage`, `ProductDetailPage`, `CartPage`, `OrdersPage`, `ContactPage`, `LoginPage`, `ShippingPage`, `AboutPage`, `ReturnsPage`, `TermsPage`, `ApiTestPage`.

### Fixture System
The framework uses `mergeTests` to combine multiple fixture sets:
- **`pages.fixture.ts`** — Pre-instantiated page objects (e.g., `homePage`, `productsPage`)
- **`auth.fixture.ts`** — Pre-authenticated pages (`adminPage`, `customerPage`)
- **`cart.fixture.ts`** — Cart-specific fixtures (e.g., `cartWithProduct`)

Import from `tests/fixtures/test-base.ts` to access all fixtures:
```typescript
import { test, expect } from '../fixtures/test-base';
```

### Authentication Strategy
- Primary: `storageState` in `playwright.config.ts` pre-authenticates all tests in a project
- Default project uses `playwright/.auth/customer.json`
- Per-test fixtures (`adminPage`, `customerPage`) available for role-specific needs
- Auth states generated by `auth.setup.ts` using test accounts:
  - Admin: `admin@test.com` / `admin123`
  - Customer: `user@test.com` / `user123`

### Configuration Notes
- **Browser:** Chromium only (for speed and consistency)
- **Workers:** 4 local, 2 in CI
- **Retries:** 2 in CI, 0 locally
- **Traces:** On first retry only (screenshots/videos disabled)
- **Base URL:** `https://music-tech-shop.vercel.app` (override via `BASE_URL` env var)

### Test Data Pattern
Test data is externalized in `tests/data/` with TypeScript interfaces:
- `users.data.ts` — Credentials (valid/invalid), auth state paths
- `products.data.ts` — 50 products across 5 categories
- `contact.data.ts` — Form payloads for validation testing
- `shipping.data.ts` — ZIP codes for shipping calculator

### Test Tagging
- `@smoke` — 22 critical path tests for quick validation
- `@regression` — 117 comprehensive tests
- Run specific tags via `--grep @tag`

### Known Gaps
- No user registration flow (app uses pre-configured accounts only)
- No checkout route in current application version
- No real payment processing (demo platform)
